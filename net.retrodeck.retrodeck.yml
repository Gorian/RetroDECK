app-id: net.retrodeck.retrodeck
runtime: org.kde.Platform
runtime-version: 5.15-22.08
#runtime-version: 6.3                        # bumped because of pcsx2-qt
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.llvm14    # Needed for rpcs3
  #- org.freedesktop.Sdk.Extension.dotnet6   # Needed for Ryujinx - Removed, check if it's not breaking something else
base: io.qt.qtwebengine.BaseApp             # Needed for Yuzu
base-version: 5.15-22.08                    # Needed for Yuzu
# add-extensions:
#   org.freedesktop.Platform.ffmpeg-full:
#     directory: lib/ffmpeg
#     add-ld-path: .
#     version: '22.08'
#     autodownload: true
#     autodelete: false
command: retrodeck.sh

finish-args:
  - --socket=x11
  #- --socket=wayland
  - --socket=pulseaudio
  - --share=ipc
  - --share=network
  - --device=all
  - --filesystem=home # Needed to be able to relocate / remove / create symlink at ~/retrodeck
  - --filesystem=/run/media
  - --filesystem=/media
  - --allow=multiarch
  - --talk-name=org.freedesktop.ScreenSaver
  - --talk-name=org.freedesktop.PowerManagement.Inhibit
  - --talk-name=org.freedesktop.login1.Manager
  - --talk-name=org.freedesktop.Flatpak
  - --filesystem=xdg-run/app/com.discordapp.Discord:create
  # Yuzu
  # - --filesystem=home:ro # This may break Yuzu, let's see
  # - --filesystem=/run/media:ro
  # Dolphin
  - --allow=bluetooth
  #- --env=QT_QPA_PLATFORM=xcb #not sure if this will break something
  # rpcs3
  #- --socket=fallback-x11

cleanup:
  # ES-DE
  - /include
  - /share/ffmpeg
  - /lib/cmake
  - /lib/pkgconfig
  # Yuzu
  - /include
  - /bin/glslangValidator
  - /bin/zip*
  - /bin/zstd*
  - /lib/pkg-config
  - /share/doc
  - /share/man
  - /src
  - '*.a'
  - '*.la'
  # XMLSTARLET
  - /lib/debug
  - /share/runtime
cleanup-commands:
  # Yuzu
  - /app/cleanup-BaseApp.sh

modules:

  # MAME - Start

  - name: mame
    buildsystem: cmake-ninja
    build-options:
      no-debuginfo: true
      strip: true
      cflags: -Wno-error=restrict USE_SYSTEM_LIB_FLAC=1 SDL_INI_PATH='$$HOME/.APP_NAME;/app/share/APP_NAME/ini' LDOPTS=-Wl,-s
    sources:
      - type: archive
        url: https://github.com/mamedev/mame/archive/refs/tags/mame0253.tar.gz
        sha256: 52065a1ae0db365a9aa35d62bafb226edc546ad993d6c75327e166596f25e4e4

  # MAME - End